<!DOCTYPE html>
<html>
<head>
    <title>VOID - Etapa 3 (Gemini Integration)</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
</head>
<body>
    <a-scene background="color: #000000">
        <a-entity id="void-core" geometry="primitive: sphere; radius: 0.1" 
                  material="color: #00FFFF; shader: flat" position="0 1.5 -2"
                  animation="property: scale; to: 1.1 1.1 1.1; dir: alternate; dur: 1000; loop: true">
        </a-entity>
        <a-camera position="0 1.6 0"><a-cursor color="#00FFFF"></a-cursor></a-camera>
    </a-scene>

    <script>
        const API_KEY = 'AIzaSyDTT1_qm8xu-8F8ymaVSnmutMeRVYjqZII'; // Substitua aqui
        const core = document.querySelector('#void-core');
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'pt-BR';

        document.body.onmousedown = () => {
            recognition.start();
            core.setAttribute('material', 'color', '#FF00FF'); // Ouvindo...
        };

        recognition.onresult = async (event) => {
            const userText = event.results[0][0].transcript;
            core.setAttribute('material', 'color', '#FFFF00'); // Pensando...

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Você é o sistema VOID. O usuário disse: "${userText}". Responda de forma curta (máximo 2 frases) e sugira uma cor em formato HEX que represente esse assunto no final da resposta como #000000.` }] }]
                    })
                });

                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;
                
                // Extrair cor e texto
                const hexColor = aiResponse.match(/#[0-9A-F]{6}/i)?.[0] || '#00FF00';
                
                // Feedback Visual no Vazio
                core.setAttribute('material', 'color', hexColor);
                
                               
                // Síntese de Voz (O Vazio fala com você)
                const utterance = new SpeechSynthesisUtterance(aiResponse.replace(hexColor, ''));
                utterance.lang = 'pt-BR';
                utterance.rate = 1.0; // Velocidade normal
                
                // Algumas versões do Safari precisam de um "empurrão"
                window.speechSynthesis.cancel(); // Limpa filas travadas
                window.speechSynthesis.speak(utterance);
                
                console.log("IA disse:", aiResponse); // Verifique no console do PC se está chegando o texto

            } catch (error) {
                console.error("Erro na API:", error);
                core.setAttribute('material', 'color', '#FF0000');
            }
        };
    </script>
</body>
</html>
